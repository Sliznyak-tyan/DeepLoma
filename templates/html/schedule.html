{% load static %}
<!doctype html>
<html>
<head>
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Каво и шо</title>
<link href="{% static 'css/schedule_style.css' %}" rel="stylesheet" type="text/css">
<!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
<!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
<!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
      <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
</head>
<body>
<div class="container">
<header>
    <div class="primary_header">
      <h1 class="title"> Система управления микроклиматом в помещении</h1>
    </div>
  <nav class="secondary_header" id="menu">
      <ul>
        <li>
            <button onclick="location.href='http://127.0.0.1:8000/system/indicators/'" id="button" class="button_class">Показатели</button>
        </li>
        <li>
            <button onclick="location.href='http://127.0.0.1:8000/system/statistics/'" id="button" class="button_class">
                Статистика
            </button>
        </li>
        <li id="active_tab">
            <button onclick="location.href='http://127.0.0.1:8000/system/schedule/'" id="button" class="button_class">
                Расписание
            </button>
        </li>
        <li>Вход</li>
      </ul>
    </nav>
</header>

  <div class="big_row">
    <div class="big_columns">
        <form action="/system/schedule/" method="post">
            {% csrf_token %}
             <div class="paddings">
                 Время начала
                 <input type="time" name="start_time" id="st_name">
                 Время окончания
                 <input type="time" name="end_time" id="en_name">
                 Температура
                 <select name="temp_value" id="te_name">
                    <option value="15" selected>15</option>
                    <option value="16">16</option>
                    <option value="17">17</option>
                     <option value="18">18</option>
                     <option value="19">19</option>
                     <option value="20">20</option>
                     <option value="21">21</option>
                     <option value="22">22</option>
                     <option value="23">23</option>
                     <option value="24">24</option>
                     <option value="25">25</option>
                 </select>
                 ℃
                 <button type="button" onclick="add_row_func()" id="submit_btn">Отправить</button>
             </div>
        </form>
     </div>
    </div>
  </div>
    <div class="big_row">
        <div class="big_columns">
            <div class="paddings">
            <table class="table_style" id="schedule_table">
                <tr>
                    <th>
                        Время начала
                    </th>
                    <th>
                        Время окончания
                    </th>
                    <th>
                        Температура
                    </th>
                    <th>
                        Удалить
                    </th>
                </tr>
                {% for schedule_element in schedule %}
                    <tr>
                        <td>
                            {{ schedule_element.start_time }}
                        </td>
                        <td>
                            {{ schedule_element.end_time }}
                        </td>
                        <td>
                            {{ schedule_element.temperature }}
                        </td>
                        <td>
                            <button onclick="delete_row(this.parentNode.parentNode.rowIndex)">
                                <img src=https://www.svgrepo.com/show/79440/delete-button.svg height = "20"
                                     width = "20" />
                            </button>
                        </td>
                    </tr>
                {% endfor %}
            </table>
                <script>
                    function add_row_func() {
                      var table = document.getElementById("schedule_table");
                      var row = table.insertRow(-1);
                      var cell1 = row.insertCell(0);
                      var cell2 = row.insertCell(1);
                      var cell3 = row.insertCell(2);
                      var cell4 = row.insertCell(3);
                      cell1.innerHTML = document.getElementById("st_name").value;
                      cell2.innerHTML = document.getElementById("en_name").value;
                      cell3.innerHTML = document.getElementById("te_name").value;
                      cell4.innerHTML = '<button id="btn" name="btn" onclick="delete_row(this.parentNode.parentNode.rowIndex)"><img ' +
                          'src=https://www.svgrepo.com/show/79440/delete-button.svg height ="20" ' +
                          'width="20" /></button>';
                      try {
                            const response = fetch('http://127.0.0.1:8000/system/schedule/', {
                              method: 'post',
                                headers: {
                                  'Content-Type': 'application/json',
                                    "X-CSRFToken": getCookie('csrftoken')
                                },
                              body: JSON.stringify({
                                      schedule_status: "add",
                                      start_time: document.getElementById("st_name").value,
                                      end_time: document.getElementById("en_name").value,
                                      temperature: document.getElementById("te_name").value
                                  })
                            });
                            console.log('Completed!', response);
                          } catch(err) {
                            console.error(`Error: ${err}`);
                          }
                    }

                    function delete_row(num){
                        document.getElementById("schedule_table").deleteRow(num);
                        try {
                            const response = fetch('http://127.0.0.1:8000/system/schedule/', {
                              method: 'post',
                                headers: {
                                  'Content-Type': 'application/json',
                                    "X-CSRFToken": getCookie('csrftoken')
                                },
                              body: JSON.stringify(
                                  {
                                    schedule_status: "delete",
                                    id: num
                                  }
                              )
                            });
                            console.log('Completed!', response);
                          } catch(err) {
                            console.error(`Error: ${err}`);
                          }
                    }

                    function getCookie(name) {
                        var cookieValue = null;
                        if (document.cookie && document.cookie !== '') {
                            var cookies = document.cookie.split(';');
                            for (var i = 0; i < cookies.length; i++) {
                                var cookie = cookies[i].trim();
                                // Does this cookie string begin with the name we want?
                                if (cookie.substring(0, name.length + 1) === (name + '=')) {
                                    cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                                    break;
                                }
                            }
                        }
                        return cookieValue;
                    }
                </script>
            </div>
        </div>
        </div>
    </div>

</body>
</html>
